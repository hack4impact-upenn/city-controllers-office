{% extends 'layouts/base.html' %}
{% import 'macros/form_macros.html' as f %}

{% block content %}
<!-- html for search page -->
<!-- @dev: Robin -->
{% set flashes = {
    'success': get_flashed_messages(category_filter=['form-success'])
  } %}
<div style="width: 70%; margin: auto;">

    <div class="ui grid" style="margin-top: 50px; height: auto; min-height: 100%; position: relative; margin-bottom: 10%;">
        <div class="four wide column">
            <div style="margin-top: 10px;">
              {% set flashes = {
                'error':   get_flashed_messages(category_filter=['form-error']),
                'warning': get_flashed_messages(category_filter=['form-check-email']),
                'info':    get_flashed_messages(category_filter=['form-info']),
                'success': get_flashed_messages(category_filter=['form-success'])
            } %}
            {{ f.begin_form(form, flashes) }}
                <div class="search-form">
                    {{ f.render_form_field(form.department) }}
                </div>
                <div class="search-form">
                    {{ f.render_form_field(form.contract_type) }}
                </div>
                <div class="search-form">
                  {{ f.render_form_field(form.vendor) }}
                </div>
                <div class="search-form">
                    {{ f.render_form_field(form.keyword) }}
                </div>
                <div class="search-form">
                    {{ f.render_form_field(form.original_contract_id) }}
                </div>
                <div class="search-form">
                    <label class="label">Date Range</label>
                    {{ f.render_form_field(form.start_dt) }}
                    {{ f.render_form_field(form.end_dt) }}
                </div>
                <div class="search-form">
                  <label class="label">Amount Range</label>
                  {{ f.render_form_field(form.minimum) }}
                  {{ f.render_form_field(form.maximum) }}
                </div>
                <div class="search-form">
                  <label class="label">Profit Status:</label>
                    {{ f.render_form_field(form.for_profit) }}
                    {{ f.render_form_field(form.non_profit) }}
                </div>
                <div class="search-form">
                  <label class="label">Exempt Status:</label>
                    {{ f.render_form_field(form.adv) }}
                    {{ f.render_form_field(form.ex) }}
                </div>
                <div class="container" style="margin-top: 20px;">
                    <div style="display: inline-block">
                        {{ f.render_form_field(form.submit) }}
                        {{ f.begin_form(database_csv_form, flashes) }}
                    </div>
                    <div style="display: inline-block">
                        {{ f.render_form(database_csv_form) }}
                        {{ f.end_form(database_csv_form) }}
                    </div>
                    <input class="fluid ui primary button" style="width: 98%" type="reset" value="Reset All">
                    {{ f.end_form(form) }}
                    <!-- Upon clicking "View Contract",
                    Displays a number of contracts depending on result of dropdown
                    Or Displays Instructions if default is selected.
                    Also shows the number of results currently displayed on that page -->
                    <script>
                        document.getElementById("viewButton").onclick = function () {
                            var numResults = parseInt($("#resultsDropdown :selected").val());
                            var instructionsContainer = document.getElementById("instructionsContainer");
                            var resultsContainer = document.getElementById('resultsContainer');
                            var displaysContainer = document.getElementById('displaysContainer');
                            // Clears instructionsContainer, resultsContainer, and displaysContainer
                            while(instructionsContainer.firstChild){
                                instructionsContainer.removeChild(instructionsContainer.firstChild);
                            }
                            while(resultsContainer.firstChild){
                                resultsContainer.removeChild(resultsContainer.firstChild);
                            }
                            while(displaysContainer.firstChild){
                                displaysContainer.removeChild(displaysContainer.firstChild);
                            }
                            var html = ''
                            if (numResults > 0) { // Populate resultsContainer and displaysContainer, depending on result of dropdown
                                html += '<div><h2>Contract Results</h2></div>'
                                for(var i = 1; i <= numResults; i++){
                                    html +=
                                    '<div class="paper">'
                                    +    '<div class="ui grid">'
                                    +        '<div class="eight wide column">'
                                    +            '<h3 class="theme-primary" style="line-height: 10px; margin-top: 5px;">'
                                    +               'Vehicle Service #'+ i
                                    +            '</h3>'
                                    +            '<p><i>FLEET MANAGEMENT SERVICES</i></p>'
                                    +        '</div>'
                                    +        '<div class="eight wide column">'
                                    +            '<div style="line-height: 20px; ">'
                                    +                '<div class="tag">'
                                    +                    'TYPE</div>'
                                    +                '<b>PROFESSIONAL'
                                    +                    'SERVICES</b>'
                                    +            '</div>'
                                    +            '<div style=" line-height: 20px;">'
                                    +                '<div class="tag">'
                                    +                    'DEPT</div><b>MANAGEMENT & BUDGET</b>'
                                    +            '</div>'
                                    +        '</div>'
                                    +        '<div class="eight wide column">'
                                    +            '<p><b>Current contact amount:</b> $XXXXX</p>'
                                    +            '<p><b>Contract:</b> $XXXXX</p>'
                                    +        '</div>'
                                    +        '<div class="eight wide column">'
                                    +            '<p><b>Original contact amount:</b> $XXXXX</p>'
                                    +            '<p><b>Contract Term:</b> $XXXXX</p>'
                                    +        '</div>'
                                    +    '</div>'
                                    +    '<button class="ui primary button" style="margin-top: 20px;">'
                                    +        'View Contract'
                                    +    '</button>'
                                    +'</div>'
                                }
                                resultsContainer.innerHTML = html
                                displaysContainer.innerHTML = 'VIEW RESULTS: 1 -' + numResults + ' OF 100'
                            }
                            else { // Populates instructionsContainer and displaysContainer if default is selected
                                html +=
                                '<div id="instructionsContainer">'
                                +    '<div>'
                                +        '<h2>'
                                +            'Instructions'
                                +        '</h2>'
                                +    '</div>'
                                +    '<div class="paper">'
                                +        '<div class="ui grid">'
                                +            '<h3 class="theme-primary" style="margin-top: 10px;">'
                                +                'Searching'
                                +            '</h3>'
                                +            '<p class="theme-secondary">'
                                +                'Search here for city contracts. You can filter by department, contract type, '
                                +                'approval date, or restrict to a contract dollar amount range. You can also search '
                                +                'by specific vendor names or keywords.'
                                +            '</p>'
                                +            '<h3 class="theme-primary">'
                                +                'Search Criteria'
                                +            '</h3>'
                                +            '<p class="theme-secondary">'
                                +                'Contract Amount can be selected based on a range from the minimum to maximum.'
                                +               'Use the sliders to select the maximum or minimum amounts.'
                                +                '<br><br>'
                                +                'Contract Approval Date can be selected based on a range using the two date widgets to the left.'
                                +            '</p>'
                                +            '<h3 class="theme-primary">'
                                +                'Search Results'
                                +            '</h3>'
                                +            '<p class="theme-secondary">'
                                +                'Since the number of results might be quite large, contracts are presented one page at a time.'
                                +                '<br><br>'
                                +                'You can set the page size from 10-100, and also sort by most of these criteria '
                                +                '(click on the arrow to the right to change the sort direction).'
                                +            '</p>'
                                +        '</div>'
                                +    '</div>'
                                +'</div>'
                                instructionsContainer.innerHTML = html
                                displaysContainer.innerHTML = 'VIEW RESULTS: 0 OF 100'
                            }
                        };
                    </script>
                </div>

            </div>

        </div>

        <div class="twelve wide column" style="margin-top: 30px">
            <div id="resultsContainer"></div>
            <div id="instructionsContainer">
                <h2 style="font-family: Avenir">
                    Instructions
                </h2>
            </div>
            <div class="paper">
                <!-- <div class="ui grid"> -->
                    <h3 class="theme-primary" style="margin-top: 10px;">
                        Searching
                    </h3>
                    <p class="theme-secondary">
                        Search here for city contracts. You can filter by department, contract type,
                        approval date, or restrict to a contract dollar amount range. You can also search
                        by specific vendor names or keywords.
                    </p>

                    <h3 class="theme-primary">
                        Search Criteria
                    </h3>
                    <p class="theme-secondary">
                        Contract Amount can be selected based on a range from the minimum to maximum.
                        Use the sliders to select the maximum or minimum amounts.
                        <br></br>
                        Contract Approval Date can be selected based on a range using the two date widgets to the left.
                    </p>

                    <h3 class="theme-primary">
                        Search Results
                    </h3>
                    <p class="theme-secondary">
                        Since the number of results might be quite large, contracts are presented one page at a time.
                        <br><br>
                        You can set the page size from 10-100, and also sort by most of these criteria
                        (click on the arrow to the right to change the sort direction).
                    </p>
                <!-- </div> -->
            </div>
        </div>

    </div>
</div>
</div>
{% endblock %}
